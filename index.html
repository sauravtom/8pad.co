<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>URL Shortener project</title>

<style type="text/css">
    textarea{
        width:300px;
        height:300px;
    }
</style>

<body>

<h3>Enter a text in the texbox below and click on the button below</h3>

<textarea id="editor"></textarea>
<button id="submit">Compress</button>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js" type="text/javascript" charset="utf-8"></script>

<script src="https://rawgit.com/flatiron/director/master/build/director.min.js"></script>
<<script src="https://cdn.rawgit.com/visionmedia/page.js/master/page.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" charset="utf-8">
    function get_short_url(long_url, login, api_key, func)
    {
    $.getJSON(
        "http://api.bitly.com/v3/shorten?callback=?", 
        { 
            "format": "json",
            "apiKey": api_key,
            "login": login,
            "longUrl": long_url
        },
        function(response)
        {
            func(response.data.url);
        }
    );
    //return short url too
    }
    
    var login = "stomatrix";
    var api_key = "R_c3691526084b291593c35ae2883e55cb";
    var long_url = "http://asdasdsad.com/#asdasd";

    /*
    get_short_url(long_url, login, api_key, function(short_url) {
        console.log(short_url);
    });
    */
    
    
    function cascade(content,list){
  
        var len=content.length
        var splits=[];
        if (len>2000)
        {
            //var n=Math.ceil(len/2000);
            splits=content.match(/.{1,2000}/g);
            sl=splits.length;
            for (i = 0; i < sl; i++) { 
                list=cascade(splits[i],list);
            }
        } 
        else
        {
            list.push(content);
        }
        return list;
    }

    
    
    $('#submit').click(function(){
      var login = "stomatrix";
      var api_key = "R_c3691526084b291593c35ae2883e55cb";
      content = $('#editor').val();
      console.log(encodeURIComponent(content));
      var list=[];
      var answer=[];
      list=cascade(content,list);
      var len=list.length;
      for (i=0;i<len;i++)
      {
        var long_url = "http://a.com/#"+list[i];
        var ret=get_short_url(long_url, login, api_key, function(short_url) {
                console.log(short_url);
        });
        ret = ret.replace(/^http:\/\/bit.ly\//, ''); // check regex for correct escaping
        answer.push(ret);
      }
      
      var final=answer.join('~.~');        //or whatever pattern
      var leng=final.length;
      if (leng==7)                     //subject to change
      {
        return final;
      }
      var ans=function(final);
      console.log(ans);
      return ans;
    });
    
    
     var router = new Router().init();

     router.on('/food', function () {
        console.log("asdasd");
        //
        // Do something on `/#/some/resource`
        //
     });
      
     
     page('/user/:id', function(context){
        var userId = context.params.id;
        console.log('Loading details for user', userId);
     });
    
    page();
    
    //$('document').ready(function() {});    
    
</script>

</body>
</html>
